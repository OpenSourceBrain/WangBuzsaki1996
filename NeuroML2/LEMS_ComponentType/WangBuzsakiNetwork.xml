<Lems xmlns="http://www.neuroml.org/lems/0.6"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.neuroml.org/lems/0.6 https://raw.github.com/LEMS/LEMS/master/Schemas/LEMS/LEMS_v0.6.xsd">

<!-- Definition in LEMS of a new ComponentType for the Wang & Buzsáki 1996 model in Wang XJ and Buzsáki Gy (1996) -->

    
    <Include file="WangBuzsakiCell.xml"/>
    


    <!-- Synapse -->
    
        <ComponentType name="wangBuzsakiSynapse"
                   extends="baseGradedSynapse"
                   description="Synapse based on Wang XJ and Buzsáki Gy (1996)">
    
        <Parameter name="g_s" dimension="conductance"/>
        <Parameter name="e_s" dimension="voltage"/>
        <Parameter name="Vth" dimension="voltage"/>
        <Parameter name="Vscale" dimension="voltage"/>
        <Parameter name="alpha" dimension="per_time"/>
        <Parameter name="beta" dimension="per_time"/>

        <Exposure name="i" dimension="current"/>
        <Exposure name="s" dimension="none"/>
        <Exposure name="F" dimension="none"/>

        <Requirement name="v" dimension="voltage"/>

        <InstanceRequirement name="peer" type="gapJunction"/>

        <Dynamics>        
            <StateVariable name="s" dimension="none" exposure="s"/>

            <DerivedVariable name="vpeer" dimension="voltage" select="peer/v"/>

            <DerivedVariable name="F" dimension="none" value="1 / (1 + exp((vpeer-Vth)/Vscale))" exposure="F"/>

            <TimeDerivative variable="s" value="alpha*F*(1-s) - beta*s" />
            
            <DerivedVariable name="i" value="g_s*s*(e_s-v)" exposure="i"/>

        </Dynamics>

    </ComponentType>
    
    
    <wangBuzsakiBasketCell id="wb2" spikeThresh="0mV" r="2.82095um" C="1pF" v0="-64.0175mV" gL="0.1mS_per_cm2" eL="-65mV" gNa="35mS_per_cm2" eNa="55mV" alpham_rate="1per_ms" alpham_midpoint="-35mV" alpham_scale="10mV"  betam_rate="4per_ms" betam_midpoint="-60mV" betam_scale="-18mV" h_q="5" alphah_rate="0.07per_ms" alphah_midpoint="-58mV" alphah_scale="-20mV" betah_rate="1per_ms" betah_midpoint="-28mV" betah_scale="-10mV"  gK="9mS_per_cm2" eK="-90mV" n_q="5" alphan_rate="1per_ms" alphan_midpoint="-34mV" alphan_scale1="100mV"  alphan_scale2="10mV" betan_rate="0.125per_ms" betan_midpoint="-44mV" betan_scale="-80mV"/> 
    
    <wangBuzsakiSynapse id="wbs1" g_s="0.1nS" e_s="-75mV" Vth="0mV" Vscale="-2mV" alpha="12per_ms" beta="0.1per_ms"/>
    
    <!--Dummy synapse which emits no current. Used as presynaptic endpoint for analog synaptic connection.-->
    <silentSynapse id="silent"/>    
    
<!-- Create a network -->
    
    <!-- The surface of the cell is 100um2 (2pA: 2uA/cm2 input)-->
    <pulseGenerator id="IClamp2" delay="10ms" duration="10ms" amplitude="2pA"/>

    <network id="net2" type="networkWithTemperature" temperature = "37 degC">
        <population id="pop1" component="wb2" type="populationList" size="1">
            <instance id="0">
                <location x="0" y="0" z="0"/>
            </instance>
        </population>
        <population id="pop2" component="wb2" type="populationList" size="1">
            <instance id="0">
                <location x="0" y="0" z="10"/>
            </instance>
        </population>

        <continuousProjection id ="WBsynapse" presynapticPopulation="pop1" postsynapticPopulation="pop2">
            <continuousConnectionInstance id="0" preCell="../pop1/0/wb2" postCell="../pop2/0/wb2" preComponent="silent" postComponent="wbs1"/>
        </continuousProjection>       

        <inputList id="IClamp" component="IClamp2" population="pop">
            <input id="0" target="../pop1/0/wb2" destination="synapses"/>
        </inputList>

    </network>

</Lems>